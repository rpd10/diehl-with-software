<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Scully 0.0.99">
  <meta charset="utf-8">
  <title>Strategy Pattern in Angular Using Dependency Injection | Diehl With Software</title>
  <base href="/diehl-with-software/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="styles.a0f8dbb50669c537439f.css"><style>.toolbar[_ngcontent-glt-c21]{place-content:center;min-height:64px}.toolbar-content[_ngcontent-glt-c21]{display:flex;flex-direction:row;align-items:center;max-width:960px;width:calc(100% - 32px)}.toolbar-content[_ngcontent-glt-c21]   a[_ngcontent-glt-c21], .toolbar-content[_ngcontent-glt-c21]   a[_ngcontent-glt-c21]:active, .toolbar-content[_ngcontent-glt-c21]   a[_ngcontent-glt-c21]:hover, .toolbar-content[_ngcontent-glt-c21]   a[_ngcontent-glt-c21]:link, .toolbar-content[_ngcontent-glt-c21]   a[_ngcontent-glt-c21]:visited{color:#fff;text-decoration:none}.content[_ngcontent-glt-c21], .toolbar-content[_ngcontent-glt-c21]   .spacer[_ngcontent-glt-c21]{flex:1 0 auto}.footer[_ngcontent-glt-c21]   .row[_ngcontent-glt-c21]{height:32px;place-content:center}.footer[_ngcontent-glt-c21]   .link[_ngcontent-glt-c21]{height:32px;width:32px;line-height:32px}</style><style>.cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}.mat-toolbar-multiple-rows{min-height:64px}.mat-toolbar-row,.mat-toolbar-single-row{height:64px}@media(max-width: 599px){.mat-toolbar-multiple-rows{min-height:56px}.mat-toolbar-row,.mat-toolbar-single-row{height:56px}}
</style><style>.mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button[disabled],.mat-icon-button[disabled],.mat-stroked-button[disabled],.mat-flat-button[disabled]{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button[disabled]{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab[disabled]{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab[disabled]{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.cdk-high-contrast-active .mat-button-focus-overlay{background-color:#fff}.cdk-high-contrast-black-on-white .mat-button-focus-overlay{background-color:#000}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:block;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}
</style><style>.mat-icon{background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}
</style><script charset="utf-8" src="common-es2015.9762d5e570429c84ac30.js"></script><script charset="utf-8" src="6-es2015.ded5634cccebb929eff8.js"></script><style>.blog-content-wrapper[_ngcontent-glt-c22]{display:flex;flex-direction:column;box-sizing:border-box;align-items:center;padding:24px}.blog-content[_ngcontent-glt-c22]{max-width:960px;width:100%}.blog-content[_ngcontent-glt-c22]   .generated[_ngcontent-glt-c22]   a[_ngcontent-glt-c22], .blog-content[_ngcontent-glt-c22]   .generated[_ngcontent-glt-c22]   a[_ngcontent-glt-c22]:active, .blog-content[_ngcontent-glt-c22]   .generated[_ngcontent-glt-c22]   a[_ngcontent-glt-c22]:hover, .blog-content[_ngcontent-glt-c22]   .generated[_ngcontent-glt-c22]   a[_ngcontent-glt-c22]:link, .blog-content[_ngcontent-glt-c22]   .generated[_ngcontent-glt-c22]   a[_ngcontent-glt-c22]:visited{color:#1976d2}.blog-content[_ngcontent-glt-c22]   .generated[_ngcontent-glt-c22]   p[_ngcontent-glt-c22], .blog-content[_ngcontent-glt-c22]   .generated[_ngcontent-glt-c22]   pre[_ngcontent-glt-c22]{margin-bottom:20px}</style><style>
      :host {
        display: none;
      }
      scully-content {
        display: none;
      }
    </style><meta name="keywords" content="blog, Angular, Dependency Injection, Design Patterns, angular strategy pattern, angular dependency injection, angular class interface, angular design patterns"><meta name="description" content="Use Angular's built-in dependency injection features to implement a variation of the strategy pattern and isolate your code from changes in vendor code and other third party dependencies."><script>window['ScullyIO']='generated';</script>
<script type="text/javascript" id="scully-plugin-discount-flash-prevention">
  function capt (ev) {
	  if (document.documentElement.scrollTop === 0) {
	  	document.documentElement.scrollTop = window['ScullyIO-scrollPosition'];
	  }
	  window['ScullyIO-scrollPosition'] = document.documentElement.scrollTop;
	  function detach() {
		window.removeEventListener('scroll', capt);
		document.removeEventListener("AngularReady", detach);
	  };
	  document.addEventListener("AngularReady", detach);
	};

	window.addEventListener('scroll', capt);

	window.addEventListener('AngularReady', scullyDiscountFlashPreventionContentScript);
	function scullyDiscountFlashPreventionContentScript(){
	  document.documentElement.scrollTop = window['ScullyIO-scrollPosition'];
		document.body.classList.add('loaded');
		const tempAppRoot = document.querySelector('rpd10-root-scully');
    tempAppRoot.parentNode.removeChild(tempAppRoot);
    window.removeEventListener('AngularReady', scullyDiscountFlashPreventionContentScript);
    window.dispatchEvent(new Event('FlashPreventionSwitchDone', {
      bubbles: true,
      cancelable: false
    }))
	}
</script>
<style type="text/css">
	body:not(.loaded) rpd10-root { display:none; }
	body:not(.loaded) rpd10-root-scully { display:flex; }
	body.loaded rpd10-root { display:flex; }
  body.loaded rpd10-root-scully { display:none; }
</style>
</head>

<body class="mat-typography mat-app-background" scully-version="0.0.99">
  <rpd10-root></rpd10-root><rpd10-root-scully _nghost-glt-c21="" ng-version="9.1.11"><mat-toolbar _ngcontent-glt-c21="" color="primary" class="mat-toolbar toolbar mat-primary mat-toolbar-single-row"><div _ngcontent-glt-c21="" class="toolbar-content"><a _ngcontent-glt-c21="" href="/">Diehl With Software</a><span _ngcontent-glt-c21="" class="spacer"></span></div></mat-toolbar><main _ngcontent-glt-c21="" class="content"><router-outlet _ngcontent-glt-c21=""></router-outlet><rpd10-blog _nghost-glt-c22=""><div _ngcontent-glt-c22="" class="blog-content-wrapper">
  <div _ngcontent-glt-c22="" class="blog-content">
    <div _ngcontent-glt-c22="" class="generated">
      <!--scullyContent-begin--><h1 id="strategy-pattern-in-angular-using-dependency-injection" _ngcontent-glt-c22="">Strategy Pattern in Angular Using Dependency Injection</h1>
<p _ngcontent-glt-c22="">Lately I've been working on swapping out our authentication provider. I started out doing some proof-of-concept work, but in
order to be able to update our existing apps in production, there's a lot to consider - interceptors, guards, login and logout
actions. Authentication is usually a cross-cutting concern, so if you have many applications in your enterprise, you've probably
implemented some sort of shared library to handle it (hopefully not built from scratch). Much of that logic is unlikely to change
if the auth provider changes. In this article, I'll show how you can leverage Angular's dependency injection to compose a strategy
for decoupling the implementation of your authentication provider. We'll focus on two aspects here - the login/logout flow, and
token acquisition for an OAuth 2.0 implementation. I'm not even going to name-drop the auth provider I'm using - with the
pattern I'm going to show, it doesn't matter!</p>
<p _ngcontent-glt-c22="">You may have heard the phrase "favor composition over inheritance" when talking about object-oriented programming. One design
pattern that illustrates this is the <a href="https://en.wikipedia.org/wiki/Strategy_pattern" _ngcontent-glt-c22="" rel="noreferrer noopener">Strategy Pattern</a>. To use this pattern,
you need to define various interfaces in order to abstract certain behaviors of a software system. Typescript provides interfaces,
but Angular cannot use them in dependency injection, because the interface is only relevant at compile-time. We'll see how to
deal with that later.</p>
<p _ngcontent-glt-c22="">In our authentication example, we can break it down into two main sets of behaviors we need to model. First, we need to handle
logging in and out, and showing details about the currently logged in user. We will probably have components that need to show
user details, and a login/logout button on a component somewhere. Additionally, if we're using routing, we will probably have
router guards in place to protect some routes - those routes will need to know if a user is logged in before allowing access to
the page. Second, after the user is logged in, we need to handle acquiring OAuth 2.0 tokens in order to communicate with our
backend APIs. Angular's HTTP interceptors are a great place to do that token acquisition.</p>
<h2 id="login-and-logout" _ngcontent-glt-c22="">Login and Logout</h2>
<p _ngcontent-glt-c22="">Let's start at the beginning for most enterprise apps - login. Again, I'm not going to focus on any specific authentication technology
here. We'll tackle the routing first. For the purposes of this exercise, let's say that we've got 2 routes in our application.
One of them is a dedicated login page, and the other is a protected page that only authenticated users should be able to see.
Here's what our <code _ngcontent-glt-c22="">app-routing.module</code> might look like:</p>
<pre _ngcontent-glt-c22=""><code class="language-typescript" _ngcontent-glt-c22="">// app-routing.module.ts
const routes: Route[] = [
  {
    path: '',
    pathMatch: 'full',
    component: LoginComponent,
  },
  {
    path: 'protected',
    component: ProtectedComponent,
    canActivate: [RequireAuthGuard],
  },
  {
    path: '**',
    redirectTo: '',
  },
];</code></pre>
<p _ngcontent-glt-c22="">If someone tries to access the <code _ngcontent-glt-c22="">/protected</code> route, our <code _ngcontent-glt-c22="">RequireAuthGuard</code> will kick in and ensure the user is authenticated.
Here's what the guard looks like:</p>
<pre _ngcontent-glt-c22=""><code class="language-typescript" _ngcontent-glt-c22="">// require-auth.guard.ts
import {
  CanActivate,
  Router,
  UrlTree,
  ActivatedRouteSnapshot,
  RouterStateSnapshot,
} from '@angular/router';
import { AuthStrategy } from './auth.strategy';

@Injectable({ providedIn: 'root' })
export class RequireAuthGuard implements CanActivate {
  constructor(private router: Router, private authStrategy: AuthStrategy) {}

  public canActivate(
    route: ActivatedRouteSnapshot,
    state: RouterStateSnapshot
  ): true | UrlTree {
    if (this.authStrategy.isLoggedIn()) {
      return true;
    }

    try {
      this.authStrategy.loginRedirect(state.url);
      return true;
    } catch (err) {
      return this.router.parseUrl('/');
    }
  }
}</code></pre>
<p _ngcontent-glt-c22="">The guard is fairly straightforward. If the user is logged in, allow access to the route, otherwise ask the auth service to authenticate
the user using a redirect flow. If anything fails in that processs, redirect to the root of the app. We leverage Angular's dependency
injection to inject an <code _ngcontent-glt-c22="">AuthStrategy</code> that will tell us if the user is logged in and handle the authentication details. Here's our <code _ngcontent-glt-c22="">AuthStrategy</code>:</p>
<pre _ngcontent-glt-c22=""><code class="language-typescript" _ngcontent-glt-c22="">// auth.strategy.ts
export abstract class AuthStrategy {
  isLoggedIn: () =&gt; boolean;

  getUserName: () =&gt; string;

  loginRedirect: (targetUrl: string) =&gt; any;

  logout: () =&gt; any;
}</code></pre>
<p _ngcontent-glt-c22="">Hmm...interesting. The AuthStrategy doesn't really do anything, it's just an abstract class that defines some methods. This is what's
called a <a href="https://angular.io/guide/dependency-injection-in-action#provider-token-alternatives-class-interface-and-injectiontoken" _ngcontent-glt-c22="" rel="noreferrer noopener">"class interface"</a>.
Since Angular's dependency injection system does not support injecting an interface, this is a way that you can accomplish the same thing.
The abstract class defines an interface for our login behaviors. Our guard only interacts with the abstract <code _ngcontent-glt-c22="">AuthStrategy</code>, so it is
totally isolated from the implementation details of the authentication provider.</p>
<p _ngcontent-glt-c22="">Let's look at the <code _ngcontent-glt-c22="">LoginComponent</code> next, we'll see the same absraction.</p>
<pre _ngcontent-glt-c22=""><code class="language-typescript" _ngcontent-glt-c22="">// login.component.ts
@Component({...})
export class LoginComponent {
  constructor(private authStrategy: AuthStrategy) {}

  public login() {
    this.authStrategy.loginRedirect('/protected');
  }
}</code></pre>
<p _ngcontent-glt-c22="">Using this strategy, we can have many different components - think app bar, sidenav, footer, etc. - be aware of the login state <em _ngcontent-glt-c22="">without</em>
being aware of the auth implementation.</p>
<h2 id="token-acquisition" _ngcontent-glt-c22="">Token Acquisition</h2>
<p _ngcontent-glt-c22="">After we've gotten a user logged in, let's assume the next problem we need to solve is calling a REST API on behalf of that user in an OAuth 2.0 flow.
We'll need to interact with our auth provider to acquire a token with the appropriate scopes. Angular's HTTP interceptors are a good choice for this.
Here again, the main flow of the interceptor is unlikely to vary between auth providers, while the details of how token acquisition happens probably will.
Let's sketch out the basic flow of the interceptor:</p>
<pre _ngcontent-glt-c22=""><code class="language-typescript" _ngcontent-glt-c22="">// auth.interceptor.ts
import {
  HttpErrorResponse,
  HttpEvent,
  HttpHandler,
  HttpInterceptor,
  HttpRequest,
} from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable, throwError } from 'rxjs';
import { catchError, mergeMap } from 'rxjs/operators';
import { TokenStrategy } from './token.strategy';

const HTTP_AUTHORIZATION_HEADER = 'Authorization';

@Injectable()
export class AuthInterceptor implements HttpInterceptor {
  constructor(private tokenStrategy: TokenStrategy) {}

  public intercept(
    req: HttpRequest&lt;any&gt;,
    next: HttpHandler
  ): Observable&lt;HttpEvent&lt;any&gt;&gt; {
    // figure out if the request requires authentication.
    const shouldAuth = this.requiresAuth(req);

    if (shouldAuth) {
      return this.tokenStrategy.acquireToken(req).pipe(
        mergeMap((token) =&gt;
          next
            .handle(
              req.clone({
                setHeaders: {
                  [HTTP_AUTHORIZATION_HEADER]: `Bearer ${token}`,
                },
              })
            )
            .pipe(
              catchError((err) =&gt; {
                // if the error is HTTP 401, call the token service to handle the error
                if (
                  err instanceof HttpErrorResponse &amp;&amp;
                  err.status === 401 &amp;&amp;
                  this.tokenStrategy.onUnauthorized
                ) {
                  this.tokenStrategy.onUnauthorized(err, token);
                }
                return throwError(err);
              })
            )
        )
      );
    } else {
      return next.handle(req);
    }
  }

  private requiresAuth(req: HttpRequest&lt;any&gt;): boolean {
    return (
      !req.headers.has(HTTP_AUTHORIZATION_HEADER) &amp;&amp;
      this.tokenStrategy.requiresAuth(req)
      // plus whatever other rules you may have - check headers, etc.
    );
  }
}</code></pre>
<p _ngcontent-glt-c22="">First we'll check the outgoing HTTP request to see if we should even bother acquiring a token - maybe it's going to a public endpoint,
or maybe it's already been authorized using some other means. If the request requires a token, we'll reach out to the token service to acquire one,
pipe the result and set the <code _ngcontent-glt-c22="">Authorization</code> header for the outgoing request, and then forward the cloned request along the HTTP interceptor chain.
We also use the catchError operator to check for HTTP 401 Unauthorized responses, and notify the token handler. Here's our <code _ngcontent-glt-c22="">TokenStrategy</code>
another class interface with no implementation.:</p>
<pre _ngcontent-glt-c22=""><code class="language-typescript" _ngcontent-glt-c22="">// token.service.ts
import { HttpErrorResponse, HttpRequest } from '@angular/common/http';
import { Observable } from 'rxjs';

export abstract class TokenStrategy {
  /**
   * Determine whether this token handler is able to acquire a token for a given request.
   *
   * @returns true if this token handler is able to acquire a token for the given request, false otherwise
   */
  requiresAuth: (req: HttpRequest&lt;any&gt;) =&gt; boolean;

  /**
   * Acquire a token for the given request.
   *
   * @returns an Observable of a bearer token
   */
  acquireToken: (req: HttpRequest&lt;any&gt;) =&gt; Observable&lt;string&gt;;

  /**
   * Handle HTTP 401 Unauthorized responses from the server.  This function is optional.
   * The auth provider may want to clear token caches, etc.
   */
  onUnauthorized?: (err: HttpErrorResponse, token: string) =&gt; void;
}</code></pre>
<h2 id="providing-concrete-implementations" _ngcontent-glt-c22="">Providing Concrete Implementations</h2>
<p _ngcontent-glt-c22="">We've decoupled the implementation details from the guard, components, and interceptors, but we still need to provide an auth implementation
in order for the app to run. For the purposes of this demonstration, we'll just outline a mock auth service and token service with some pseudo-code.</p>
<pre _ngcontent-glt-c22=""><code class="language-typescript" _ngcontent-glt-c22="">// mock-auth.service.ts
@Injectable({ providedIn: 'root' })
export class MockAuthService implements AuthStrategy {
  constructor(private mockAuthLib: MockAuthLib) {}

  getUserName = () =&gt; this.mockAuthLib.getIdToken()?.userName;

  isLoggedIn = () =&gt; !!this.getUserName();

  loginRedirect = (targetUrl: string) =&gt;
    this.mockAuthLib.loginWithRedirect(targetUrl);

  logout = () =&gt; this.mockAuthLib.logout();
}

// mock-token.service.ts
@Injectable({ providedIn: 'root' })
export class MockTokenStrategy implements TokenStrategy {
  constructor(private mockAuthLib: MockAuthLib) {}

  requiresAuth = (req: HttpRequest&lt;any&gt;) =&gt;
    this.mockAuthLib.isProtectedRequest(req.url);

  acquireToken = (req: HttpRequest&lt;any&gt;) =&gt;
    this.mockAuthLib.acquireTokenSilent(req.url);

  onUnauthorized = (err: HttpErrorResponse, token: string) =&gt;
    this.mockAuthLib.clearTokenCache(token);
}</code></pre>
<p _ngcontent-glt-c22="">The final piece of the puzzle is telling Angular's dependency injection how to provide the <code _ngcontent-glt-c22="">AuthStrategy</code> and <code _ngcontent-glt-c22="">TokenStrategy</code> for our
components, guards, and interceptors. Remember, those resources inject the generic class interfaces, not a specific implementation,
so we have to tell Angular which class to use as the concrete class. To do that, we can use the <code _ngcontent-glt-c22="">useExisting</code> provider option.</p>
<pre _ngcontent-glt-c22=""><code class="language-typescript" _ngcontent-glt-c22="">// app.module.ts
@NgModule({
  imports: [
    HttpClientModule,
    MockAuthLibModule, // whatever auth library you're using
    ...
  ],
  declarations: [...],
  providers: [
    { provide: HTTP_INTERCEPTORS, multi: true, useClass: AuthInterceptor },
    { provide: AuthStrategy, useExisting: MockAuthService },
    { provide: TokenStrategy, useExisting: MockTokenService }
  ]
})
export class AppModule {}</code></pre>
<p _ngcontent-glt-c22="">With this configuration, Angular will be able to inject the correct implementations, and all is well. The beauty of this is that in
the future when you need to support some other authentication method, the amount of code you need to change is minimized - you don't
need to touch any of the guards, interceptors, components or other services - you just need to provide a new implementation for the
strategies! Once you embrace this powerful pattern, you will find yourself using it to isolate your code from changes in third party
dependencies.</p>
<p _ngcontent-glt-c22="">You can see an example repository here: <a href="https://github.com/rpd10/example-angular-strategy-pattern" _ngcontent-glt-c22="" rel="noreferrer noopener">https://github.com/rpd10/example-angular-strategy-pattern</a></p>
<!--scullyContent-end--><script>try {window['scullyContent'] = {cssId:"_ngcontent-glt-c22",html:document.body.innerHTML.split('<!--scullyContent-begin-->')[1].split('<!--scullyContent-end-->')[0]};} catch(e) {console.error('scully could not parse content');}</script><scully-content _ngcontent-glt-c22=""></scully-content>
    </div>
    <a _ngcontent-glt-c22="" rel="noopener noreferrer" target="_blank" mat-flat-button="" color="primary" aria-label="share this article on Twitter" class="mat-focus-indicator mat-flat-button mat-button-base mat-primary" href="https://twitter.com/intent/tweet?url=http://localhost:1864/blog/angular-strategy-pattern-with-di" tabindex="0" aria-disabled="false"><span class="mat-button-wrapper">
      <mat-icon _ngcontent-glt-c22="" role="img" svgicon="twitter" class="mat-icon notranslate mat-icon-no-color" aria-hidden="true"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 400 400" style="enable-background:new 0 0 400 400;" xml:space="preserve" fit="" height="100%" width="100%" preserveAspectRatio="xMidYMid meet" focusable="false">
<style type="text/css">
	.st0{opacity:0.15;fill:#1976D2;}
	.st1{fill:#FFFFFF;}
 </style>
<g id="_x31_0_x2013_20_x25__Black_Tint">
	<rect class="st0" width="400" height="400"></rect>
</g>
<g id="Logo__x2014__FIXED">
	<g>
		<path class="st1" d="M153.6,301.6c94.3,0,145.9-78.2,145.9-145.9c0-2.2,0-4.4-0.1-6.6c10-7.2,18.7-16.3,25.6-26.6
			c-9.2,4.1-19.1,6.8-29.5,8.1c10.6-6.3,18.7-16.4,22.6-28.4c-9.9,5.9-20.9,10.1-32.6,12.4c-9.4-10-22.7-16.2-37.4-16.2
			c-28.3,0-51.3,23-51.3,51.3c0,4,0.5,7.9,1.3,11.7c-42.6-2.1-80.4-22.6-105.7-53.6c-4.4,7.6-6.9,16.4-6.9,25.8
			c0,17.8,9.1,33.5,22.8,42.7c-8.4-0.3-16.3-2.6-23.2-6.4c0,0.2,0,0.4,0,0.7c0,24.8,17.7,45.6,41.1,50.3c-4.3,1.2-8.8,1.8-13.5,1.8
			c-3.3,0-6.5-0.3-9.6-0.9c6.5,20.4,25.5,35.2,47.9,35.6c-17.6,13.8-39.7,22-63.7,22c-4.1,0-8.2-0.2-12.2-0.7
			C97.7,293.1,124.7,301.6,153.6,301.6"></path>
	</g>
</g>
</svg></mat-icon>
      Tweet
    </span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></a>
  </div>
</div>
</rpd10-blog><!----></main><footer _ngcontent-glt-c21=""><mat-toolbar _ngcontent-glt-c21="" color="primary" class="mat-toolbar footer mat-primary mat-toolbar-multiple-rows"><mat-toolbar-row _ngcontent-glt-c21="" class="mat-toolbar-row row"><span _ngcontent-glt-c21="" class="mat-body-1">Find me on</span><a _ngcontent-glt-c21="" mat-icon-button="" aria-label="find me on twitter" href="https://www.twitter.com/DiehlWithRyan" target="_blank" rel="noopener noreferrer" class="mat-focus-indicator link mat-icon-button mat-button-base" tabindex="0" aria-disabled="false"><span class="mat-button-wrapper"><mat-icon _ngcontent-glt-c21="" role="img" svgicon="twitter" class="mat-icon notranslate mat-icon-no-color" aria-hidden="true"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 400 400" style="enable-background:new 0 0 400 400;" xml:space="preserve" fit="" height="100%" width="100%" preserveAspectRatio="xMidYMid meet" focusable="false">
<style type="text/css">
	.st0{opacity:0.15;fill:#1976D2;}
	.st1{fill:#FFFFFF;}
 </style>
<g id="_x31_0_x2013_20_x25__Black_Tint">
	<rect class="st0" width="400" height="400"></rect>
</g>
<g id="Logo__x2014__FIXED">
	<g>
		<path class="st1" d="M153.6,301.6c94.3,0,145.9-78.2,145.9-145.9c0-2.2,0-4.4-0.1-6.6c10-7.2,18.7-16.3,25.6-26.6
			c-9.2,4.1-19.1,6.8-29.5,8.1c10.6-6.3,18.7-16.4,22.6-28.4c-9.9,5.9-20.9,10.1-32.6,12.4c-9.4-10-22.7-16.2-37.4-16.2
			c-28.3,0-51.3,23-51.3,51.3c0,4,0.5,7.9,1.3,11.7c-42.6-2.1-80.4-22.6-105.7-53.6c-4.4,7.6-6.9,16.4-6.9,25.8
			c0,17.8,9.1,33.5,22.8,42.7c-8.4-0.3-16.3-2.6-23.2-6.4c0,0.2,0,0.4,0,0.7c0,24.8,17.7,45.6,41.1,50.3c-4.3,1.2-8.8,1.8-13.5,1.8
			c-3.3,0-6.5-0.3-9.6-0.9c6.5,20.4,25.5,35.2,47.9,35.6c-17.6,13.8-39.7,22-63.7,22c-4.1,0-8.2-0.2-12.2-0.7
			C97.7,293.1,124.7,301.6,153.6,301.6"></path>
	</g>
</g>
</svg></mat-icon></span><div matripple="" class="mat-ripple mat-button-ripple mat-button-ripple-round"></div><div class="mat-button-focus-overlay"></div></a></mat-toolbar-row><mat-toolbar-row _ngcontent-glt-c21="" class="mat-toolbar-row row"><span _ngcontent-glt-c21="" class="mat-caption">Copyright © 2020. All Rights Reserved.</span></mat-toolbar-row></mat-toolbar></footer></rpd10-root-scully>
<script id="ScullyIO-transfer-state"></script><script src="runtime-es2015.0a6213ac7a1539af845d.js" type="module"></script><script src="runtime-es5.0a6213ac7a1539af845d.js" nomodule="" defer=""></script><script src="polyfills-es5.39a5a0773d6939b0ac3c.js" nomodule="" defer=""></script><script src="polyfills-es2015.ab3ae01b5028dac3455c.js" type="module"></script><script src="main-es2015.2ee5cd753708fd8cbbdd.js" type="module"></script><script src="main-es5.2ee5cd753708fd8cbbdd.js" nomodule="" defer=""></script>


</body></html>